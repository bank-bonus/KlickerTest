<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>–û—Ç–∫—Ä—ã—Ç–∏–µ –ö–µ–π—Å–æ–≤ –í–ö</title>
    <style>
        body {
            background-color: #1b1b1b;
            color: white;
            font-family: -apple-system, system-ui, Roboto, sans-serif;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }

        /* –ë–∞–ª–∞–Ω—Å */
        .header {
            width: 100%;
            padding: 20px;
            background: #222;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
            z-index: 10;
        }
        .balance {
            font-size: 24px;
            color: #4bb34b;
            font-weight: bold;
        }

        /* –°–∞–º–∞ —Ä—É–ª–µ—Ç–∫–∞ */
        .roulette-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            height: 140px;
            background: #111;
            margin-top: 40px;
            overflow: hidden;
            border-top: 2px solid #333;
            border-bottom: 2px solid #333;
        }
        
        /* –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –ª–∏–Ω–∏—è (—É–∫–∞–∑–∞—Ç–µ–ª—å) */
        .center-line {
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 4px;
            background: #e8c64d;
            transform: translateX(-50%);
            z-index: 5;
            box-shadow: 0 0 10px #e8c64d;
        }

        /* –õ–µ–Ω—Ç–∞ —Å –ø—Ä–µ–¥–º–µ—Ç–∞–º–∏ */
        .strip {
            display: flex;
            height: 100%;
            align-items: center;
            /* –ù–∞—á–∞–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è —Å–¥–≤–∏–≥–∞ */
            transform: translateX(0px); 
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∞ –ø—Ä–µ–¥–º–µ—Ç–∞ */
        .item {
            min-width: 100px;
            height: 100px;
            margin: 0 5px;
            background: #2b2b2b;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 30px;
            border-bottom: 4px solid #555;
            position: relative;
        }
        .item span { font-size: 10px; margin-top: 5px; color: #ccc; }
        
        /* –¶–≤–µ—Ç–∞ —Ä–µ–¥–∫–æ—Å—Ç–∏ */
        .rarity-1 { border-bottom-color: #b0c3d9; } /* –û–±—ã—á–Ω–æ–µ (–°–µ—Ä—ã–π) */
        .rarity-2 { border-bottom-color: #5e98d9; } /* –†–µ–¥–∫–æ–µ (–°–∏–Ω–∏–π) */
        .rarity-3 { border-bottom-color: #8847ff; } /* –ú–∏—Ñ–∏—á–µ—Å–∫–æ–µ (–§–∏–æ–ª–µ—Ç–æ–≤—ã–π) */
        .rarity-4 { border-bottom-color: #d32ce6; } /* –õ–µ–≥–µ–Ω–¥–∞ (–†–æ–∑–æ–≤—ã–π) */
        .rarity-5 { border-bottom-color: #eb4b4b; } /* –≠–ø–∏–∫ (–ö—Ä–∞—Å–Ω—ã–π) */
        .rarity-6 { border-bottom-color: #ffd700; box-shadow: 0 0 15px #ffd700; } /* –ó–æ–ª–æ—Ç–æ */

        /* –ö–Ω–æ–ø–∫–∞ */
        .controls {
            margin-top: 50px;
            text-align: center;
        }
        button {
            background: linear-gradient(90deg, #fdc830 0%, #f37335 100%);
            border: none;
            padding: 15px 50px;
            color: white;
            font-size: 20px;
            font-weight: bold;
            border-radius: 30px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(243, 115, 53, 0.4);
            transition: transform 0.1s;
        }
        button:disabled {
            background: #555;
            box-shadow: none;
            cursor: not-allowed;
        }
        button:active { transform: scale(0.95); }

        /* –í—Å–ø–ª—ã–≤–∞—é—â–µ–µ –æ–∫–Ω–æ –≤—ã–∏–≥—Ä—ã—à–∞ */
        #win-modal {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.9);
            z-index: 100;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s;
        }
        .win-card {
            background: #222;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            border: 2px solid #444;
        }
        .win-icon { font-size: 80px; margin-bottom: 20px; display: block; }
        .win-title { font-size: 24px; font-weight: bold; color: white; margin-bottom: 10px; }
        .win-price { font-size: 20px; color: #4bb34b; margin-bottom: 20px; }
        
        .sell-btn {
            background: #4bb34b;
            width: 100%;
            margin-top: 10px;
        }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <div class="header">
        <div>–¢–≤–æ–π –±–∞–ª–∞–Ω—Å:</div>
        <div class="balance" id="balance-display">2000 $</div>
    </div>

    <!-- –û–±–ª–∞—Å—Ç—å —Ä—É–ª–µ—Ç–∫–∏ -->
    <div class="roulette-container">
        <div class="center-line"></div>
        <div class="strip" id="strip">
            <!-- –°—é–¥–∞ JavaScript –¥–æ–±–∞–≤–∏—Ç –ø—Ä–µ–¥–º–µ—Ç—ã -->
        </div>
    </div>

    <div class="controls">
        <div style="margin-bottom: 10px; color: #aaa;">–¶–µ–Ω–∞ –∫–µ–π—Å–∞: 500 $</div>
        <button id="spin-btn" onclick="spin()">–û–¢–ö–†–´–¢–¨</button>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–∏–≥—Ä—ã—à–∞ -->
    <div id="win-modal">
        <div class="win-card" id="win-card-ui">
            <span class="win-icon" id="modal-icon">üéÅ</span>
            <div class="win-title" id="modal-name">–ü—Ä–µ–¥–º–µ—Ç</div>
            <div class="win-price" id="modal-price">+ 0 $</div>
            <button class="sell-btn" onclick="collectPrize()">–ü–†–û–î–ê–¢–¨</button>
        </div>
    </div>

    <!-- VK Bridge -->
    <script src="https://unpkg.com/@vkontakte/vk-bridge/dist/browser.min.js"></script>

    <script>
        // --- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–≥—Ä—ã ---
        let balance = 2000;
        const casePrice = 500;
        
        // –°–ø–∏—Å–æ–∫ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ (–æ—Ç –¥–µ—à–µ–≤—ã—Ö –∫ –¥–æ—Ä–æ–≥–∏–º)
        // chance - —ç—Ç–æ "–≤–µ—Å" –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏. –ß–µ–º –±–æ–ª—å—à–µ —á–∏—Å–ª–æ, —Ç–µ–º —á–∞—â–µ –ø–∞–¥–∞–µ—Ç.
        const items = [
            { id: 1, name: "–ù–∞—É—à–Ω–∏–∫–∏", icon: "üéß", price: 150, rarity: 1, chance: 400 }, // 40%
            { id: 2, name: "–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞", icon: "‚å®Ô∏è", price: 300, rarity: 2, chance: 250 }, // 25%
            { id: 3, name: "iPhone 15", icon: "üì±", price: 900, rarity: 3, chance: 150 }, // 15%
            { id: 4, name: "MacBook", icon: "üíª", price: 1500, rarity: 4, chance: 100 }, // 10%
            { id: 5, name: "–ê–≤—Ç–æ–º–æ–±–∏–ª—å", icon: "üöó", price: 5000, rarity: 5, chance: 40 },  // 4%
            { id: 6, name: "–Ø—Ö—Ç–∞", icon: "üõ•Ô∏è", price: 50000, rarity: 6, chance: 9 },   // 0.9%
            { id: 7, name: "–°–ê–ú–û–õ–ï–¢", icon: "‚úàÔ∏è", price: 1000000, rarity: 6, chance: 1 } // 0.1% –î–ñ–ï–ö–ü–û–¢
        ];

        // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è VK ---
        vkBridge.send('VKWebAppInit');

        const strip = document.getElementById('strip');
        const btn = document.getElementById('spin-btn');
        const balanceEl = document.getElementById('balance-display');
        const modal = document.getElementById('win-modal');
        let currentWinningItem = null;

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞ —Å —É—á–µ—Ç–æ–º —à–∞–Ω—Å–æ–≤
        function getRandomItem() {
            let totalWeight = items.reduce((sum, item) => sum + item.chance, 0);
            let random = Math.random() * totalWeight;
            
            for (let item of items) {
                if (random < item.chance) {
                    return item;
                }
                random -= item.chance;
            }
            return items[0];
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –æ–¥–Ω–æ–≥–æ –∫–≤–∞–¥—Ä–∞—Ç–∏–∫–∞
        function createCard(item) {
            const div = document.createElement('div');
            div.className = `item rarity-${item.rarity}`;
            div.innerHTML = `${item.icon}<span>${item.price}$</span>`;
            return div;
        }

        // –ù–∞—á–∞–ª—å–Ω–∞—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (–≤–∏–∑—É–∞–ª—å–Ω–∞—è –ª–µ–Ω—Ç–∞)
        function initStrip() {
            strip.innerHTML = '';
            // –°–æ–∑–¥–∞–µ–º 50 —Å–ª—É—á–∞–π–Ω—ã—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –¥–ª—è –≤–∏–¥–∞
            for(let i=0; i<50; i++) {
                strip.appendChild(createCard(getRandomItem()));
            }
        }
        initStrip();

        // --- –õ–æ–≥–∏–∫–∞ –≤—Ä–∞—â–µ–Ω–∏—è ---
        function spin() {
            if (balance < casePrice) {
                vkBridge.send("VKWebAppTapticNotificationOccurred", {"type": "error"});
                alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥! –ü—Ä–æ–¥–∞–π —á—Ç–æ-–Ω–∏–±—É–¥—å –∏–ª–∏ –Ω–∞—á–Ω–∏ –∑–∞–Ω–æ–≤–æ (–æ–±–Ω–æ–≤–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—É).");
                return;
            }

            // –°–ø–∏—Å—ã–≤–∞–µ–º –¥–µ–Ω—å–≥–∏
            balance -= casePrice;
            updateBalance();
            
            btn.disabled = true; // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É
            btn.innerText = "–ö–†–£–¢–ò–ú...";

            // 1. –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ–±–µ–¥–∏—Ç–µ–ª—è –ó–ê–†–ê–ù–ï–ï
            const winner = getRandomItem();
            currentWinningItem = winner;

            // 2. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤—É—é –ª–µ–Ω—Ç—É
            // –ù–∞–º –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã –ø–æ–±–µ–¥–∏—Ç–µ–ª—å –±—ã–ª –≥–¥–µ-—Ç–æ –¥–∞–ª–µ–∫–æ, –Ω–∞–ø—Ä–∏–º–µ—Ä –Ω–∞ 75-–π –ø–æ–∑–∏—Ü–∏–∏
            strip.style.transition = 'none';
            strip.style.transform = 'translateX(0px)';
            strip.innerHTML = '';

            const cardWidth = 110; // 100px —à–∏—Ä–∏–Ω–∞ + 10px –æ—Ç—Å—Ç—É–ø—ã
            const winningIndex = 60; // –ü–æ–±–µ–¥–∏—Ç–µ–ª—å –±—É–¥–µ—Ç 60-–º –ø–æ —Å—á–µ—Ç—É

            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—Ä–µ–¥–º–µ—Ç—ã –¥–æ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
            for(let i=0; i < winningIndex; i++) {
                strip.appendChild(createCard(getRandomItem()));
            }
            // –î–æ–±–∞–≤–ª—è–µ–º –ü–û–ë–ï–î–ò–¢–ï–õ–Ø
            strip.appendChild(createCard(winner));
            // –î–æ–±–∞–≤–ª—è–µ–º –µ—â–µ –Ω–µ–º–Ω–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –ø–æ—Å–ª–µ
            for(let i=0; i < 10; i++) {
                strip.appendChild(createCard(getRandomItem()));
            }

            // 3. –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
            // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞, —á—Ç–æ–±—ã –±—Ä–∞—É–∑–µ—Ä –ø–æ–Ω—è–ª, —á—Ç–æ –º—ã —Å–±—Ä–æ—Å–∏–ª–∏ transform
            setTimeout(() => {
                // –í—ã—á–∏—Å–ª—è–µ–º, –Ω–∞ —Å–∫–æ–ª—å–∫–æ –ø–∏–∫—Å–µ–ª–µ–π —Å–¥–≤–∏–Ω—É—Ç—å
                // –ß—Ç–æ–±—ã –ø–æ–±–µ–¥–∏—Ç–µ–ª—å –æ–∫–∞–∑–∞–ª—Å—è –ø–æ —Ü–µ–Ω—Ç—Ä—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (—à–∏—Ä–∏–Ω–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ ~600, —Ü–µ–Ω—Ç—Ä 300)
                // winningIndex * cardWidth = –ø–æ–∑–∏—Ü–∏—è –Ω–∞—á–∞–ª–∞ –∫–∞—Ä—Ç–æ—á–∫–∏
                // + cardWidth/2 = —Ü–µ–Ω—Ç—Ä –∫–∞—Ä—Ç–æ—á–∫–∏
                
                // –†–∞–Ω–¥–æ–º–∏–∑–∞—Ü–∏—è –≤–Ω—É—Ç—Ä–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ (—á—Ç–æ–±—ã —Å—Ç—Ä–µ–ª–∫–∞ –Ω–µ –≤—Å–µ–≥–¥–∞ –≤ —Ü–µ–Ω—Ç—Ä –±–∏–ª–∞)
                const randomOffset = Math.floor(Math.random() * 80) - 40; 
                
                const positionToScroll = (winningIndex * cardWidth) - (strip.parentElement.offsetWidth / 2) + (cardWidth / 2) + randomOffset;

                strip.style.transition = "transform 5s cubic-bezier(0.1, 0, 0.2, 1)"; // –≠—Ñ—Ñ–µ–∫—Ç –∑–∞–º–µ–¥–ª–µ–Ω–∏—è
                strip.style.transform = `translateX(-${positionToScroll}px)`;

                // –ó–≤—É–∫/–í–∏–±—Ä–∞—Ü–∏—è –≤ –∫–æ–Ω—Ü–µ
                setTimeout(() => {
                    showWin(winner);
                }, 5000); // –ñ–¥–µ–º 5 —Å–µ–∫—É–Ω–¥ (–¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∞–Ω–∏–º–∞—Ü–∏–∏)

            }, 50);
        }

        function showWin(item) {
            // –í–∏–±—Ä–∞—Ü–∏—è —É—Å–ø–µ—Ö–∞
            if (vkBridge.isWebView()) {
                vkBridge.send("VKWebAppTapticNotificationOccurred", {"type": "success"});
            }

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–∫–Ω–æ
            document.getElementById('modal-icon').innerText = item.icon;
            document.getElementById('modal-name').innerText = item.name;
            document.getElementById('modal-price').innerText = `–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏: ${item.price} $`;
            
            // –†–∞—Å–∫—Ä–∞—à–∏–≤–∞–µ–º —Ä–∞–º–∫—É –≤ —Ü–≤–µ—Ç —Ä–µ–¥–∫–æ—Å—Ç–∏
            const ui = document.getElementById('win-card-ui');
            ui.className = `win-card rarity-${item.rarity}`;
            ui.style.borderWidth = "4px";
            ui.style.borderStyle = "solid";
            
            modal.style.display = "flex";
        }

        function collectPrize() {
            balance += currentWinningItem.price;
            updateBalance();
            modal.style.display = "none";
            btn.disabled = false;
            btn.innerText = "–û–¢–ö–†–´–¢–¨";
            initStrip(); // –°–±—Ä–æ—Å –ª–µ–Ω—Ç—ã
        }

        function updateBalance() {
            balanceEl.innerText = balance + " $";
        }
    </script>
</body>
</html>
