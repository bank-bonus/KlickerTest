<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Case Simulator –í–ö</title>
    <style>
        :root {
            --bg-color: #1b1b1b;
            --card-bg: #2b2b2b;
            --accent: #e8c64d;
            --green: #4bb34b;
            --red: #e64646;
        }
        body {
            background-color: var(--bg-color);
            color: white;
            font-family: -apple-system, system-ui, Roboto, sans-serif;
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
            user-select: none;
        }

        /* --- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å --- */
        .header {
            padding: 15px;
            background: #222;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
            z-index: 20;
        }
        .balance-box { font-size: 18px; font-weight: bold; color: var(--green); }
        .inv-btn {
            background: #333; border: 1px solid #555; color: white;
            padding: 8px 15px; border-radius: 8px; font-size: 14px; cursor: pointer;
        }

        /* --- –≠–∫—Ä–∞–Ω—ã --- */
        .screen {
            flex: 1;
            display: none; /* –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —ç–∫—Ä–∞–Ω—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
            flex-direction: column;
            overflow-y: auto; /* –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –¥–ª—è –º–µ–Ω—é */
            padding-bottom: 20px;
        }
        .active-screen { display: flex; }

        /* --- –≠–∫—Ä–∞–Ω 1: –°–ø–∏—Å–æ–∫ –∫–µ–π—Å–æ–≤ --- */
        .case-list {
            padding: 20px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        .case-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            border: 2px solid transparent;
            transition: transform 0.1s;
        }
        .case-card:active { transform: scale(0.95); }
        .case-icon { font-size: 50px; margin-bottom: 10px; display: block; }
        .case-name { font-weight: bold; margin-bottom: 5px; font-size: 14px; }
        .case-price { color: var(--accent); font-weight: bold; font-size: 14px; }

        /* --- –≠–∫—Ä–∞–Ω 2: –†—É–ª–µ—Ç–∫–∞ --- */
        .game-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
        }
        .back-btn {
            position: absolute; top: 70px; left: 20px;
            background: none; border: none; color: #888; font-size: 16px; cursor: pointer;
        }
        .roulette-container {
            position: relative;
            width: 100%;
            height: 140px;
            background: #111;
            border-top: 2px solid #444;
            border-bottom: 2px solid #444;
            overflow: hidden;
            margin: 20px 0;
        }
        .center-line {
            position: absolute; left: 50%; top: 0; bottom: 0;
            width: 4px; background: var(--accent);
            transform: translateX(-50%); z-index: 5;
            box-shadow: 0 0 10px var(--accent);
        }
        .strip { display: flex; height: 100%; align-items: center; }
        
        /* –ö–∞—Ä—Ç–æ—á–∫–∞ –ø—Ä–µ–¥–º–µ—Ç–∞ */
        .item {
            min-width: 100px; height: 100px; margin: 0 5px;
            background: #252525; border-radius: 8px;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            font-size: 30px; border-bottom: 4px solid #555;
            position: relative;
        }
        .item span { font-size: 10px; margin-top: 5px; color: #ccc; }
        
        /* –†–µ–¥–∫–æ—Å—Ç—å */
        .r-1 { border-color: #b0c3d9; } /* –û–±—ã—á–Ω–æ–µ */
        .r-2 { border-color: #5e98d9; } /* –†–µ–¥–∫–æ–µ */
        .r-3 { border-color: #8847ff; } /* –≠–ø–∏–∫ */
        .r-4 { border-color: #d32ce6; } /* –õ–µ–≥–µ–Ω–¥–∞ */
        .r-5 { border-color: #eb4b4b; } /* –ú–∏—Ñ–∏–∫ */
        .r-6 { border-color: #ffd700; box-shadow: 0 0 10px #ffd700; } /* –ó–æ–ª–æ—Ç–æ */

        .spin-btn {
            background: linear-gradient(90deg, #fdc830 0%, #f37335 100%);
            border: none; padding: 15px 60px; color: white;
            font-size: 20px; font-weight: bold; border-radius: 30px;
            box-shadow: 0 5px 20px rgba(243, 115, 53, 0.4);
        }
        .spin-btn:disabled { filter: grayscale(1); opacity: 0.5; }

        /* --- –≠–∫—Ä–∞–Ω 3: –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å --- */
        .inventory-grid {
            padding: 20px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        .inv-item {
            background: #252525; padding: 10px; border-radius: 8px;
            text-align: center; position: relative;
        }
        .inv-sell-one {
            margin-top: 5px; background: #333; color: var(--green);
            border: none; width: 100%; padding: 4px; border-radius: 4px; font-size: 12px;
        }
        .empty-msg { text-align: center; color: #666; margin-top: 50px; width: 100%; }

        /* --- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ --- */
        #win-modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 100;
            flex-direction: column; justify-content: center; align-items: center;
            animation: fadeIn 0.3s;
        }
        .win-card {
            background: #222; padding: 25px; border-radius: 20px;
            text-align: center; width: 280px; border: 2px solid #444;
        }
        .win-img { font-size: 80px; margin-bottom: 10px; }
        .btn-group { display: flex; gap: 10px; margin-top: 20px; }
        .btn-action { flex: 1; padding: 12px; border: none; border-radius: 8px; color: white; font-weight: bold; font-size: 14px; }
        .btn-sell { background: var(--green); }
        .btn-keep { background: #5181b8; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <!-- –®–∞–ø–∫–∞ -->
    <div class="header">
        <div class="balance-box" id="balance">5000 $</div>
        <button class="inv-btn" onclick="showInventory()">üéí –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</button>
    </div>

    <!-- 1. –ú–ï–ù–Æ –ö–ï–ô–°–û–í -->
    <div id="screen-menu" class="screen active-screen">
        <div style="padding: 20px; text-align: center; color: #888;">–í—ã–±–µ—Ä–∏—Ç–µ –∫–µ–π—Å:</div>
        <div class="case-list" id="cases-container">
            <!-- –°—é–¥–∞ –≤—Å—Ç–∞–≤—è—Ç—Å—è –∫–µ–π—Å—ã —á–µ—Ä–µ–∑ JS -->
        </div>
    </div>

    <!-- 2. –≠–ö–†–ê–ù –ò–ì–†–´ (–†—É–ª–µ—Ç–∫–∞) -->
    <div id="screen-game" class="screen">
        <button class="back-btn" onclick="showMenu()">‚Üê –ù–∞–∑–∞–¥ –∫ –∫–µ–π—Å–∞–º</button>
        <div class="game-area">
            <h2 id="current-case-name" style="margin-bottom: 0;">–ù–∞–∑–≤–∞–Ω–∏–µ</h2>
            <div id="current-case-price" style="color: #888; margin-bottom: 20px;">0 $</div>

            <div class="roulette-container">
                <div class="center-line"></div>
                <div class="strip" id="strip"></div>
            </div>

            <button class="spin-btn" id="spin-btn" onclick="spin()">–û–¢–ö–†–´–¢–¨</button>
        </div>
    </div>

    <!-- 3. –≠–ö–†–ê–ù –ò–ù–í–ï–ù–¢–ê–†–Ø -->
    <div id="screen-inventory" class="screen">
        <button class="back-btn" style="position:static; margin: 15px;" onclick="showMenu()">‚Üê –ù–∞–∑–∞–¥</button>
        <div class="inventory-grid" id="inventory-grid">
            <!-- –ü—Ä–µ–¥–º–µ—Ç—ã -->
        </div>
        <button onclick="sellAll()" style="margin: 20px; padding: 15px; background: var(--red); color: white; border:none; border-radius: 10px;">–ü–†–û–î–ê–¢–¨ –í–°–Å</button>
    </div>

    <!-- –û–∫–Ω–æ –ø–æ–±–µ–¥—ã -->
    <div id="win-modal">
        <div class="win-card" id="win-card-ui">
            <div class="win-img" id="win-icon">üéÅ</div>
            <h3 id="win-name">–ü—Ä–µ–¥–º–µ—Ç</h3>
            <p style="color: #aaa;" id="win-price-text">–°—Ç–æ–∏–º–æ—Å—Ç—å: 100 $</p>
            
            <div class="btn-group">
                <button class="btn-action btn-sell" onclick="actionSell()">üí∞ –ü—Ä–æ–¥–∞—Ç—å<br><span id="sell-price-btn" style="font-size:11px">+100$</span></button>
                <button class="btn-action btn-keep" onclick="actionKeep()">üéí –í –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å</button>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/@vkontakte/vk-bridge/dist/browser.min.js"></script>
    <script>
        vkBridge.send('VKWebAppInit');

        // --- –î–ê–ù–ù–´–ï –ò–ì–†–´ ---
        let balance = 5000;
        let inventory = [];
        let currentCaseId = null;
        let currentWonItem = null;

        // –ü—Ä–µ–¥–º–µ—Ç—ã (–æ–±—â–∏–π –ø—É–ª)
        const itemsDB = {
            garbage: [
                { name: "–°—Ç–∏–∫–µ—Ä", icon: "üìÑ", price: 10, rarity: 1 },
                { name: "–ß–µ—Ö–æ–ª", icon: "üì±", price: 50, rarity: 1 },
                { name: "–§–ª–µ—à–∫–∞", icon: "üíæ", price: 80, rarity: 1 },
            ],
            low: [
                { name: "–ù–∞—É—à–Ω–∏–∫–∏", icon: "üéß", price: 200, rarity: 2 },
                { name: "–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞", icon: "‚å®Ô∏è", price: 400, rarity: 2 },
                { name: "–ú—ã—à—å", icon: "üñ±Ô∏è", price: 300, rarity: 2 },
            ],
            mid: [
                { name: "–ß–∞—Å—ã", icon: "‚åö", price: 800, rarity: 3 },
                { name: "iPhone 12", icon: "üì±", price: 1200, rarity: 3 },
                { name: "iPad", icon: "üìü", price: 1500, rarity: 3 },
            ],
            high: [
                { name: "MacBook", icon: "üíª", price: 3000, rarity: 4 },
                { name: "PC Gamer", icon: "üñ•Ô∏è", price: 5000, rarity: 4 },
            ],
            super: [
                { name: "Tesla", icon: "üöó", price: 50000, rarity: 5 },
                { name: "–î–æ–º", icon: "üè†", price: 150000, rarity: 5 },
            ],
            god: [
                { name: "–Ø—Ö—Ç–∞", icon: "üõ•Ô∏è", price: 500000, rarity: 6 },
                { name: "–°–∞–º–æ–ª–µ—Ç", icon: "‚úàÔ∏è", price: 2000000, rarity: 6 },
            ]
        };

        // –ö–µ–π—Å—ã (–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —à–∞–Ω—Å–æ–≤)
        const cases = [
            {
                id: 0, name: "–ë–æ–º–∂ –ë–æ–∫—Å", price: 100, icon: "üì¶",
                pool: [...itemsDB.garbage, ...itemsDB.low], // –ú—É—Å–æ—Ä + –î–µ—à–µ–≤–æ–µ
                weights: [70, 30] // 70% –º—É—Å–æ—Ä, 30% –Ω–æ—Ä–º
            },
            {
                id: 1, name: "–ú–∞–∂–æ—Ä –ë–æ–∫—Å", price: 1000, icon: "üíº",
                pool: [...itemsDB.low, ...itemsDB.mid, ...itemsDB.high],
                weights: [50, 40, 10] // –†–∏—Å–∫–æ–≤–∞–Ω–Ω–æ
            },
            {
                id: 2, name: "–û–ª–∏–≥–∞—Ä—Ö –ë–æ–∫—Å", price: 10000, icon: "üíé",
                pool: [...itemsDB.mid, ...itemsDB.high, ...itemsDB.super, ...itemsDB.god],
                weights: [50, 30, 15, 5] // –®–∞–Ω—Å –Ω–∞ —Å–∞–º–æ–ª–µ—Ç
            }
        ];

        // --- UI –§–£–ù–ö–¶–ò–ò ---
        function updateBalance() {
            document.getElementById('balance').innerText = balance + " $";
        }

        function renderCases() {
            const container = document.getElementById('cases-container');
            container.innerHTML = '';
            cases.forEach(c => {
                const div = document.createElement('div');
                div.className = 'case-card';
                div.onclick = () => openGame(c.id);
                div.innerHTML = `
                    <span class="case-icon">${c.icon}</span>
                    <div class="case-name">${c.name}</div>
                    <div class="case-price">${c.price} $</div>
                `;
                container.appendChild(div);
            });
        }

        function switchScreen(screenName) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active-screen'));
            document.getElementById('screen-' + screenName).classList.add('active-screen');
        }

        function showMenu() { switchScreen('menu'); }
        
        function showInventory() {
            renderInventory();
            switchScreen('inventory');
        }

        function renderInventory() {
            const grid = document.getElementById('inventory-grid');
            grid.innerHTML = '';
            if (inventory.length === 0) {
                grid.innerHTML = '<div class="empty-msg">–ü—É—Å—Ç–æ...</div>';
                return;
            }
            inventory.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = `inv-item r-${item.rarity}`;
                div.innerHTML = `
                    <div style="font-size:30px">${item.icon}</div>
                    <div style="font-size:12px; margin:5px 0;">${item.name}</div>
                    <button class="inv-sell-one" onclick="sellFromInventory(${index})">–ü—Ä–æ–¥–∞—Ç—å: ${item.price}$</button>
                `;
                grid.appendChild(div);
            });
        }

        function openGame(caseId) {
            currentCaseId = caseId;
            const c = cases[caseId];
            document.getElementById('current-case-name').innerText = c.name;
            document.getElementById('current-case-price').innerText = "–¶–µ–Ω–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è: " + c.price + " $";
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –ª–µ–Ω—Ç—É —Ñ–µ–π–∫–æ–≤—ã–º–∏ –ø—Ä–µ–¥–º–µ—Ç–∞–º–∏ –¥–ª—è –∫—Ä–∞—Å–æ—Ç—ã
            initStrip(c);
            switchScreen('game');
        }

        // --- –õ–û–ì–ò–ö–ê –†–£–õ–ï–¢–ö–ò ---
        
        // –ü–æ–ª—É—á–∏—Ç—å —Å–ª—É—á–∞–π–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç –∏–∑ –∫–µ–π—Å–∞ (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤–µ—Å–æ–≤ –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞)
        function getRandomItemFromCase(c) {
            // –í —ç—Ç–æ–º –ø—Ä–∏–º–µ—Ä–µ –ø—Ä–æ—Å—Ç–æ –±–µ—Ä–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –∏–∑ –ø—É–ª–∞
            // –î–ª—è –Ω–∞—Å—Ç–æ—è—â–µ–π –∏–≥—Ä—ã —Ç—É—Ç –Ω—É–∂–Ω–∞ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤, –Ω–æ –¥–ª—è —Ç–µ—Å—Ç–∞ –ø–æ–π–¥–µ—Ç —Ä–∞–Ω–¥–æ–º
            const randIndex = Math.floor(Math.random() * c.pool.length);
            return c.pool[randIndex];
        }

        function createCard(item) {
            const div = document.createElement('div');
            div.className = `item r-${item.rarity}`;
            div.innerHTML = `${item.icon}<span>${item.price}$</span>`;
            return div;
        }

        function initStrip(c) {
            const strip = document.getElementById('strip');
            strip.innerHTML = '';
            strip.style.transition = 'none';
            strip.style.transform = 'translateX(0)';
            for(let i=0; i<30; i++) {
                strip.appendChild(createCard(getRandomItemFromCase(c)));
            }
        }

        function spin() {
            const c = cases[currentCaseId];
            if (balance < c.price) {
                alert("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –¥–µ–Ω–µ–≥!");
                return;
            }

            balance -= c.price;
            updateBalance();

            const btn = document.getElementById('spin-btn');
            btn.disabled = true;

            // –í—ã–±–∏—Ä–∞–µ–º –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
            // –ó–¥–µ—Å—å —è –¥–æ–±–∞–≤–∏–ª —à–∞–Ω—Å: —á–µ–º –¥–æ—Ä–æ–∂–µ –∫–µ–π—Å, —Ç–µ–º –∫—Ä—É—á–µ –ø—Ä–∏–∑—ã
            // (–í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ —Ç—É—Ç —Å–ª–æ–∂–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞, —è —Å–¥–µ–ª–∞–ª –ø—Ä–æ—Å—Ç—É—é –≤—ã–±–æ—Ä–∫—É)
            let winner = getRandomItemFromCase(c);
            // –î–∞–¥–∏–º —à–∞–Ω—Å –Ω–∞ –∫—Ä—É—Ç–æ–π –¥—Ä–æ–ø –≤ –¥–æ—Ä–æ–≥–∏—Ö –∫–µ–π—Å–∞—Ö
            if (c.id === 2 && Math.random() > 0.9) winner = itemsDB.god[Math.floor(Math.random()*2)];

            currentWonItem = winner;

            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ª–µ–Ω—Ç—É
            const strip = document.getElementById('strip');
            strip.innerHTML = '';
            strip.style.transition = 'none';
            strip.style.transform = 'translateX(0)';

            const winIndex = 40;
            const cardWidth = 110;

            for(let i=0; i<winIndex; i++) strip.appendChild(createCard(getRandomItemFromCase(c)));
            strip.appendChild(createCard(winner));
            for(let i=0; i<10; i++) strip.appendChild(createCard(getRandomItemFromCase(c)));

            // –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ —Å—Ç–∞—Ä—Ç–æ–º
            setTimeout(() => {
                const offset = (Math.random() * 60) - 30; // –†–∞–∑–±—Ä–æ—Å –≤–Ω—É—Ç—Ä–∏ –∫–∞—Ä—Ç–æ—á–∫–∏
                const scrollPos = (winIndex * cardWidth) - (strip.parentElement.offsetWidth / 2) + (cardWidth / 2) + offset;

                strip.style.transition = "transform 4s cubic-bezier(0.15, 0, 0.2, 1)";
                strip.style.transform = `translateX(-${scrollPos}px)`;

                setTimeout(() => showWinModal(winner), 4000);
            }, 50);
        }

        function showWinModal(item) {
            if (vkBridge.isWebView()) vkBridge.send("VKWebAppTapticNotificationOccurred", {"type": "success"});
            
            document.getElementById('win-icon').innerText = item.icon;
            document.getElementById('win-name').innerText = item.name;
            document.getElementById('win-price-text').innerText = `–¶–µ–Ω–∞: ${item.price} $`;
            document.getElementById('sell-price-btn').innerText = `+ ${item.price} $`;
            
            const ui = document.getElementById('win-card-ui');
            ui.className = `win-card r-${item.rarity}`;
            
            document.getElementById('win-modal').style.display = 'flex';
        }

        // --- –î–ï–ô–°–¢–í–ò–Ø –° –ü–†–ò–ó–û–ú ---

        function actionSell() {
            balance += currentWonItem.price;
            closeModal();
        }

        function actionKeep() {
            inventory.push(currentWonItem);
            closeModal();
        }

        function closeModal() {
            document.getElementById('win-modal').style.display = 'none';
            document.getElementById('spin-btn').disabled = false;
            updateBalance();
            initStrip(cases[currentCaseId]); // –°–±—Ä–æ—Å
        }

        // --- –£–ü–†–ê–í–õ–ï–ù–ò–ï –ò–ù–í–ï–ù–¢–ê–†–ï–ú ---
        function sellFromInventory(index) {
            const item = inventory[index];
            balance += item.price;
            inventory.splice(index, 1); // –£–¥–∞–ª–∏—Ç—å –∏–∑ –º–∞—Å—Å–∏–≤–∞
            updateBalance();
            renderInventory(); // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤–∞—Ç—å
        }

        function sellAll() {
            if(!inventory.length) return;
            if(!confirm("–¢–æ—á–Ω–æ –ø—Ä–æ–¥–∞—Ç—å –≤—Å—ë?")) return;
            
            let total = 0;
            inventory.forEach(i => total += i.price);
            balance += total;
            inventory = [];
            
            updateBalance();
            renderInventory();
        }

        // –°—Ç–∞—Ä—Ç
        renderCases();
        updateBalance();

    </script>
</body>
    </html>
